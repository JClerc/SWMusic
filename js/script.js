"use strict";function AmbientLight(e,t){this.video=e,this.ambient=t,this.light1=t.querySelector(".light-1"),this.light2=t.querySelector(".light-2"),this.interval=-1}var App={},$=document.querySelector.bind(document),$$=document.querySelectorAll.bind(document);!function(){App["goto"]=function(e,t){var n=$("section.visible"),i=$(".page."+e),o=t?"up":"down";if(!i||"boolean"!=typeof t)throw new Error("Wrong arguments: "+i+", "+t);if(n==i)throw new Error("Moving to the same page..");if(n){var a=n.getAttribute("data-page");App.call(a,"unloading"),n.classList.remove("visible"),n.classList.add("exit-"+o),n.addEventListener("animationend",function r(e){App.call(a,"unloaded"),n.removeEventListener("animationend",r),n.classList.remove("exit-"+o)})}App.call(e,"loading"),i.classList.add("visible"),i.classList.add("enter-"+o),i.addEventListener("animationend",function s(t){App.call(e,"loaded"),i.removeEventListener("animationend",s),i.classList.remove("enter-"+o),"home"!==e&&App.setLocation(e)})},App.home=function(){window.location.href?window.location.href=window.location.href.substring(0,window.location.href.indexOf("#")-1):window.location.reload()};var e=!1;App.setLocation=function(t){e=!0,window.location.hash="#/"+t,setTimeout(function(){e=!1},1)},App.gotoHash=function(t){if(!e){if(window.location.hash&&window.location.hash.length>2){var n=window.location.hash.substring(2),i=$(".page."+n);if("home"===n)return void App.home();if(i&&i.classList.contains("page")){var o=$("section.visible");if(o){o.classList.remove("visible");var a=o.getAttribute("data-page");App.call(a,"unloading"),App.call(a,"unloaded")}return i.classList.add("visible"),App.call(n,"loading"),App.call(n,"loaded"),void(window.HYPERSPACE=!1)}}t&&App.home()}};var t={};App.call=function(e,n){if(t[e]&&t[e][n])for(var i=t[e][n].length-1;i>=0;i--)t[e][n][i]()},App.bind=function(e,n,i){t[e]||(t[e]={}),t[e][n]||(t[e][n]=[]),t[e][n].push(i)}}(),window.AudioContext=function(){return window.AudioContext||window.webkitAudioContext||window.mozAudioContext}(),function(){for(var e=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),o=Math.max(0,16-(i-e)),a=window.setTimeout(function(){t(i+o)},o);return e=i+o,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),AmbientLight.prototype.play=function(){this.ambient.classList.add("active");var e=this;this.interval=setInterval(function(){var t=e.light1.classList.contains("active")?e.light2:e.light1;if(!t.children[0]){var n=document.createElement("canvas");n.getContext("2d");n.width=1,n.height=1,n.classList.add("background"),t.appendChild(n)}t.children[0].getContext("2d").drawImage(e.video,0,0,1,1),e.light1.classList.toggle("active"),e.light2.classList.toggle("active")},1e3)},AmbientLight.prototype.stop=function(){this.ambient.classList.remove("active"),clearInterval(this.interval)},function(){var e=!1,t=$(".episode-1 .drawing canvas"),n=$(".episode-1 .video"),i=new AmbientLight(n,$(".episode-1 .ambient"));if(t&&t.getContext){t.width=window.innerWidth,t.height=window.innerHeight;var o,a,r,s,d,l,c=t.getContext("2d"),u=t.width,h=t.height,p=30,f=30,g=40,m=null,v=!1,w=1024,A="media/episode1.mp3",b=~~(u/2),y=~~(h/2),L=0,T=-1,x=0,C=Math.PI/2,E=function(){a=o.createBufferSource(),r=o.createAnalyser(),s=o.createScriptProcessor(w,1,1),d=new Uint8Array(r.frequencyBinCount),l=new Uint8Array(r.frequencyBinCount),a.connect(o.destination),a.connect(r),r.connect(s),s.connect(o.destination)},M=function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){o.decodeAudioData(t.response,function(e){m=e,q(m)},k)},t.send()},q=function(e){a.buffer=e,a.start(0),a.loop=!0,v=!0},k=function(e){console.warn(e)},F=function(e){for(var t,n=0,i=e.length,o=0;o<i;o++)n+=e[o];return t=n/i};c.strokeStyle="white",c.shadowBlur=100,c.shadowColor="rgb(220, 20, 220)";var I=function(){c.lineWidth=3;var e,t,n=d.length,i=~~(n/f),o=~~(u/f),a=150;for(c.beginPath(),c.moveTo(0,y),e=0,t=i;t<n-i;t+=i)e++,c.lineTo(e*o,(Math.random()*a-a/2)*x+y);c.lineTo(u,y),c.stroke()},P=function(){if(e){S();var t,n,i=0,o=l.length-300,a=~~(o/g),r=~~(b/g);for(c.lineWidth=~~(3+6*Math.random()),c.beginPath(),c.moveTo(0,y),t=0,n=o-a;n>=0;n-=a)t++,i=l[n+5]/256,c.lineTo(t*r,h-y-i*y*Math.sin(C+t/5)*x);for(t=0,n=0;n<o-2*a;n+=a)t++,i=l[n+5]/256,c.lineTo(b+t*r,h-y-i*y*Math.cos(C+t/5)*x);c.lineTo(u,y),c.stroke();var s=d.length,p=~~(s/f),m=~~(u/f);for(c.lineWidth=~~(2+4*Math.random()),c.beginPath(),c.moveTo(0,y),t=0,n=p;n<s-p;n+=p)t++,i=h-h*d[n]/256-1,c.lineTo(t*m,i);for(c.lineTo(u,y),c.stroke(),c.beginPath(),c.moveTo(0,y),t=0,n=s-p;n>=p;n-=p)t++,i=h-h*d[n]/256-1,c.lineTo(t*m,i);c.lineTo(u,y),c.stroke()}},S=function(){c.clearRect(0,0,u,h)};try{o=new AudioContext}catch(B){console.warn("Web Audio API is not supported in this browser")}App.bind("episode-1","loaded",function(){e=!0,E(),n.currentTime=0,n.play(),i.play(),s.addEventListener("audioprocess",function(e){var t=(new Date).getTime();L>t-p||(L=t,x=F(l)/100,r.getByteTimeDomainData(d),r.getByteFrequencyData(l),v===!0&&window.requestAnimationFrame(P))}),null===m?M(A):q(m),T=setInterval(I,62)}),App.bind("episode-1","unloading",function(){clearInterval(T),i.stop(),e=!1,a.stop(0),v=!1}),App.bind("episode-1","unloaded",function(){S(),n.currentTime=0,n.pause()})}}(),function(){var e=!1,t=$(".episode-2 .canvas"),n=$(".episode-2 .drawing canvas"),i=$(".episode-2 .video"),o=new AmbientLight(i,$(".episode-2 .ambient"));if(t&&t.getContext){t.width=500,t.height=500,n.width=window.innerWidth,n.height=window.innerHeight;var a,r,s,d,l,c,u=t.getContext("2d"),h=n.getContext("2d"),p=t.width,f=t.height,g=n.width,m=n.height,v=30,w=40,A=null,b=!1,y=1024,L="media/episode2.mp3",T=~~(g/2),x=~~(m/2),C=0,E=[],M=function(){var e=[],t=!1,n=0,i=0,o=function(o){var a=o.count;i=o.width,n=o.height;for(var r=.106*i>>0,s=document.getElementById("circles"),d=0;d<a;d++){var l=document.createElement("div");l.style.width=l.style.height=d/a*r+"px",l.classList.add("circle"),e.push(l),s.appendChild(l)}t=!0},a=256,r=function(t){for(var n=0,i=16,o=0,r=.05,s=0;s<e.length;s++){var d=e[s];d.style.cssText="-webkit-transform:scale("+t[s]/a+")",s<e.length/2?(n+=i,o+=s<1/1.5?r:r):n-=i,d.style.backgroundColor="rgba(0,0,"+n+","+r+")"}};return{init:o,isInitialized:function(){return t},renderFrame:r}}(),q=function(){r=a.createBufferSource(),s=a.createAnalyser(),d=a.createScriptProcessor(y,1,1),l=new Uint8Array(s.frequencyBinCount),c=new Uint8Array(s.frequencyBinCount),r.connect(a.destination),r.connect(s),s.connect(d),d.connect(a.destination)},k=function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){a.decodeAudioData(t.response,function(e){A=e,F(A)},I)},t.send()},F=function(e){r.buffer=e,r.start(0),r.loop=!0,b=!0},I=function(e){console.warn(e)},P=function(){var e={};return e.x=250,e.y=250,e.speed={},e.speed.x=10*Math.random()-5,e.speed.y=10*Math.random()-5,e.style="white",e.radius=1,e},S=function(){for(var e=0;e<E.length;e++){var n=E[e];(n.x<0||n.x>t.width||n.y<0||n.y>t.height)&&(n=E[e]=P()),n.x+=n.speed.x,n.y+=n.speed.y,u.beginPath(),u.fillStyle=n.style,u.arc(n.x,n.y,n.radius,0,2*Math.PI),u.fill()}},B=function(){if(e){D(),S(),M.renderFrame(c);var t,n,i=0;h.strokeStyle="white",h.shadowBlur=100,h.shadowColor="rgb(20, 20, 220)";var o=c.length-300,a=~~(o/w),r=~~(T/w),s=-1;for(h.lineWidth=~~(3+6*Math.random()),h.beginPath(),t=0,n=o-a;n>=0;n-=a)t++,s>-1?(i=c[n+5]/256,h.lineTo(t*r,m-x-i*x)):c[n+5]/256>.1&&(s=n,h.moveTo(t*r,x));for(t=0,n=0;n<o-2*a-(o-s);n+=a)t++,i=c[n+5]/256,h.lineTo(T+t*r,m-x-i*x);for(h.lineTo(T+t*r+a,x),h.stroke(),h.lineWidth=~~(3+6*Math.random()),h.beginPath(),h.moveTo(0,x),t=0,s=-1,n=o-a;n>=0;n-=a)t++,s>-1?(i=c[n+5]/256,h.lineTo(t*r,m-x+i*x)):c[n+5]/256>.1&&(s=n,h.moveTo(t*r,x));for(t=0,n=0;n<o-2*a-(o-s);n+=a)t++,i=c[n+5]/256,h.lineTo(T+t*r,m-x+i*x);h.lineTo(T+t*r+a,x),h.stroke()}},D=function(){u.clearRect(0,0,p,f),h.clearRect(0,0,g,m)};try{a=new AudioContext}catch(W){console.warn("Web Audio API is not supported in this browser")}for(var H=0;H<100;H++)E.push(P());App.bind("episode-2","loaded",function(){e=!0,q(),i.currentTime=0,i.play(),o.play(),M.isInitialized()||M.init({count:10,width:360,height:360}),d.addEventListener("audioprocess",function(e){var t=(new Date).getTime();C>t-v||(C=t,s.getByteFrequencyData(c),b===!0&&window.requestAnimationFrame(B))}),null===A?k(L):F(A)}),App.bind("episode-2","unloading",function(){o.stop(),e=!1,r.stop(0),b=!1}),App.bind("episode-2","unloaded",function(){D(),i.currentTime=0,i.pause()})}}(),function(){var e=.1,t=!0;App.bind("home","unloading",function(){var t=setInterval(function(){e=1.3*(e+.1),e>70&&clearInterval(t)},100),n=$(".page.home"),i=$(".page.select");n.classList.add("exit-hyperspace"),i.classList.add("enter-hyperspace")}),App.bind("home","unloaded",function(){t=!1;var e=$(".page.home"),n=$(".page.select");e.classList.remove("visible"),e.classList.remove("exit-hyperspace"),n.classList.remove("enter-hyperspace")}),function(n){if(n.width=window.innerWidth,n.height=window.innerHeight,n.getContext){for(var i=n.getContext("2d"),o=n.width,a=n.height,r=100,s=10,d=[],l=function(){var e=Math.random(),t=Math.random(),n=~~(80*Math.random()+20);return{x:e*o,y:t*a,xs:(e*o-o/2)/500,ys:(t*a-a/2)/500,size:~~(n/20),length:Math.random()*s,color:"rgb("+n+", "+n+", "+~~(n+20*Math.random())+")"}},c=0;c<r;c++)d.push(l());!function u(){if(t){window.requestAnimationFrame(u),i.clearRect(0,0,o,a);for(var n=0;n<r;n++){var s=d[n];(s.x<0||s.y<0||s.x>o||s.y>a)&&(s=d[n]=l()),i.strokeStyle=s.color,i.lineWidth=s.size,i.shadowBlur=5,i.lineCap="round",i.shadowColor="#555",i.beginPath(),i.moveTo(s.x,s.y),i.lineTo(s.x+.1+s.length*s.xs*e,s.y+s.length*s.ys*e),i.stroke(),s.x+=s.xs*e,s.y+=s.ys*e}}}()}}($(".hyperspace"))}(),function(){var e=function(e){for(var t=e.length-1;t>=0;t--){var n=new Image;n.src=e[t]}};App.init=function(){e(["img/film-1.jpg","img/film-2.jpg","img/film-3.jpg","img/film-4.jpg","img/film-5.jpg","img/film-6.jpg","img/film-7.jpg","img/lock.svg","img/star-wars-logo.svg","img/starship-left.png","img/starship-right.png","img/vote-left.jpg","img/vote-right.jpg"]),window.addEventListener("load",function(){var e=$("section.loader");if(e&&(e.addEventListener("transitionend",function(){e.classList.remove("visible","fade-out")}),e.classList.add("fade-out")),window.location.hash&&window.location.hash.length>2){var t=window.location.hash.substring(2),n=$(".page."+t);if(n&&n.classList.contains("page"))return n.classList.add("visible"),App.call(t,"loading"),void App.call(t,"loaded")}$(".page.home").classList.add("visible"),App.call("home","loading"),App.call("home","loaded")})}}(),function(){$(".begin").addEventListener("click",function(e){App.call("home","unloading"),App.call("select","loading");var t=$(".page.select");t.addEventListener("animationend",function n(e){t.removeEventListener("animationend",n),App.call("home","unloaded"),App.call("select","loaded"),$(".page.select").classList.add("visible"),App.setLocation("select")})});for(var e=function(e){e.addEventListener("click",function(e){this.getAttribute("data-target")&&App["goto"](this.getAttribute("data-target"),"up"===this.getAttribute("data-direction")),e.preventDefault()})},t=$$(".navigation"),n=t.length-1;n>=0;n--)e(t[n]);window.addEventListener("hashchange",App.gotoHash)}(),function(){var e={lastMove:0,leftOffset:window.screen.width/2-100,rightOffset:0,screenScale:100-100/1.75,selectCards:$(".select .cards")};e.percentDivisor=window.screen.width-e.rightOffset-e.leftOffset;var t=function(t){var n=(new Date).getTime();if(e.lastMove<n-20){e.lastMove=n;var i=(t.screenX-e.leftOffset)/e.percentDivisor;i<0?i=0:i>1&&(i=1),e.selectCards.style.transform="translateZ(0) translateX(-"+i*e.screenScale+"%)"}};App.bind("select","loading",function(){document.addEventListener("mousemove",t)}),App.bind("select","unloading",function(){document.removeEventListener("mousemove",t)})}(),function(){for(var e=$$(".button-vote"),t=function(t){t.addEventListener("click",function(n){for(var i=e.length-1;i>=0;i--)e[i].innerHTML="VOTE";t.innerHTML="I Voted !"})},n=e.length-1;n>=0;n--)t(e[n])}(),App.init();
//# sourceMappingURL=script.js.map
